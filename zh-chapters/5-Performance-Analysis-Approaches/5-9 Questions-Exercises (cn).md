## 问题和练习 {.unlisted .unnumbered}

1. 在以下场景中你会使用哪些方法？
    - 场景 1：客户支持团队报告客户问题：升级到新版本应用程序后，特定操作的性能下降了 10%。
    - 场景 2：客户支持团队报告客户问题：某些交易完成时间比平时长 2 倍，没有特定模式。
    - 场景 3：您正在评估三种不同的压缩算法，想知道每种算法都存在哪些类型的性能瓶颈（内存延迟/带宽、分支预测错误等）。
    - 场景 4：有一个新的闪亮库声称比您目前项目中集成的库更快；您决定比较它们的性能。
    - 场景 5：您被要求分析不熟悉代码的性能；想知道某个分支被采取的频率以及循环执行的迭代次数。

    **AI 解答** ：
    在这些场景中，我会采用以下方法：
    - 场景 1：性能下降问题
        - 性能比较：首先，我会使用基准测试工具（如Linux Perf或其他性能分析工具）来比较新旧版本在相同条件下的性能。
        - 代码插桩：如果需要更详细的信息，我会在关键代码区域进行代码插桩，以收集特定运行时信息。
        - 跟踪：使用系统调用跟踪工具（如strace）来监控应用程序的行为，以便发现可能的系统资源瓶颈。
        - 采样：进行性能采样以识别性能下降的关键热点。
    - 场景 2：交易完成时间异常
        - 跟踪：使用跟踪工具来记录交易完成过程中的系统调用和事件，以便分析延迟的原因。
        - 采样：进行性能采样，特别关注交易处理期间的性能数据。
        - 工作负载特征化：分析交易处理的工作负载特征，以确定是否存在异常模式。
    - 场景 3：评估压缩算法性能瓶颈
        - Roofline 性能模型：使用Rooﬂine模型来评估每种算法的性能，并识别可能的瓶颈（如内存带宽或计算速度）。
        - 性能计数器：使用性能计数器来收集每种算法的详细性能数据，如缓存未命中、分支预测错误等。
        - 静态性能分析：对算法的汇编代码进行静态分析，以预测其在真实硬件上的行为。
    - 场景 4：比较新旧库性能
        - 基准测试：设计和运行基准测试来比较新旧库的性能。
        - 性能采样：使用性能采样工具来收集新旧库在执行时的性能数据。
        - 编译器优化报告：检查编译器优化报告，了解是否有优化被遗漏或可以改进的地方。
    - 场景 5：分析不熟悉的代码
        - 代码插桩：在关键的代码路径上进行代码插桩，以收集执行频率和迭代次数等信息。
        - 跟踪：使用跟踪工具来监控程序的执行流程，帮助理解代码结构和逻辑。
        - 性能分析工具：使用性能分析工具（如Linux Perf）来识别热点和性能瓶颈。

    在所有这些场景中，我会结合使用多种性能分析方法，以确保从不同角度全面理解性能问题，并找到最有效的优化策略。

2. 运行您每天使用的应用程序。使用本章讨论的方法进行性能分析练习。收集各种 CPU 性能事件的原始计数，找到热点，收集 roofline 数据，并生成和研究程序中热点函数的编译器优化报告。
