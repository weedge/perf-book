## 问题和练习 {.unlisted .unnumbered}

1. CPU核心时钟与参考时钟之间的区别是什么？
2. 退役指令与执行指令之间的区别是什么？
3. 当你提高频率时，IPC（每个周期内的指令数）是上升、下降还是保持不变？
4. 查看表{@tbl:perf_metrics}中的`DRAM BW Use`公式。你认为为什么会有一个常数`64`？
5. 使用MLC、stream或其他工具，测量你用于开发/基准测试的机器上的缓存层次结构和内存的带宽和延迟。
6. 运行你日常使用的应用程序。收集性能指标。有什么让你感到惊讶的吗？

**AI回答：**

1. **CPU核心时钟与参考时钟的区别**：
   - CPU核心时钟是CPU实际运行的频率，它决定了CPU执行指令的速度。这个频率可能会因为CPU的动态频率调整技术（如Intel的Turbo Boost）而变化，以适应不同的工作负载。
   - 参考时钟是一个固定的时钟信号，通常由外部时钟发生器提供，它为CPU提供了一个基准频率。在没有动态频率调整的情况下，核心时钟和参考时钟的频率是相同的。

2. **退役指令与执行指令的区别**：
   - 退役指令（Retired Instructions）是指CPU已经完成执行并提交结果的指令。这些指令已经通过了所有的执行阶段，包括执行、访存和写回结果。
   - 执行指令（Executed Instructions）是指CPU正在处理的指令，它们可能还在执行阶段，尚未完成。在现代处理器中，由于推测执行的存在，执行的指令数量可能会超过退役的指令数量。

3. **提高频率时IPC的变化**：
   - IPC（Instructions Per Clock，每个时钟周期内的指令数）是一个衡量CPU效率的指标，它与CPU的微架构设计有关。理论上，当你提高CPU的频率时，IPC应该保持不变，因为IPC不受时钟频率的影响。然而，在实际情况中，提高频率可能会影响CPU的缓存命中率、分支预测的准确性等，从而间接影响IPC。

4. **`DRAM BW Use`公式中的常数`64`**：
   - 在`DRAM BW Use`（动态随机存取内存带宽使用）公式中，常数`64`通常与内存数据总线的宽度有关。在许多现代计算机系统中，内存总线宽度为64位（或8字节），这意味着每个内存时钟周期可以传输64位的数据。这个常数用于将内存操作的原始计数转换为更易于理解的单位，如GB/s。

5. **测量缓存层次结构和内存的带宽和延迟**：
   - 使用MLC（Memory Latency Checker）、stream或其他性能分析工具可以测量机器上的缓存层次结构和内存的带宽和延迟。这些工具通过生成特定的内存访问模式来评估系统在不同负载下的性能。例如，MLC可以测量在空闲状态下的内存延迟，以及在不同读写比例下的内存带宽。

6. **日常应用程序的性能指标收集**：
   - 运行日常使用的应用程序并收集性能指标可以帮助了解应用程序在实际环境中的表现。可能会发现一些出乎意料的行为，例如，某些应用程序在特定条件下可能会有较高的CPU利用率或内存带宽需求，这可能揭示了性能瓶颈或优化机会。这些发现可以指导开发者进行性能优化，或者在系统设计时做出更明智的决策。


**容量规划练习**：假设你是案例研究中四个应用程序的所有者。公司管理层要求你为每个应用程序建立一个小型计算农场，主要目标是最大化性能（吞吐量）。你得到的预算有限，但足以购买1台中档服务器系统（Mac Studio、Supermicro/Dell/HPE服务器机架等）或1台高端台式机（带超频CPU、液冷、顶级GPU、快速DRAM），总共4台机器。这些可以是完全不同的四种系统。此外，你可以用这些钱购买3-4台低端系统，选择权在你。管理层希望每个应用程序的预算控制在10,000美元以内，但如果你能证明这笔开支是合理的，他们愿意灵活调整（10-20%）。假设Stockfish仍然是单线程的。再次查看这四个应用程序的性能特征，并为每个工作负载写下你会购买的计算机部件（CPU、内存、如有必要的独立GPU）。你会优先考虑哪些规格参数？你会在哪些部分选择最昂贵的部件，又在哪里可以节省资金？尽可能详细地描述，搜索网络以找到确切的组件及其价格。考虑系统的所有组成部分：主板、硬盘驱动器、冷却解决方案、电源供应单元、机架/机箱/塔式等。你会运行哪些额外的性能实验来指导你的决策？

**chatGPT 回答建议**：

在进行容量规划时，首先需要了解每个应用程序的性能特征和需求。然后，需要考虑可用预算以及性能优化的可能性。下面是对每个应用程序的考虑以及可能的硬件选择：

1. **Stockfish（国际象棋引擎）**：
   - **性能特征**：CPU 密集型，单线程。
   - **建议硬件**：
     - CPU：选择单线程性能最高的处理器，如 Intel Core i9-12900K 或 AMD Ryzen 9 5950X。价格大约在600-800美元之间。
     - 内存：8GB DDR4 3200MHz 单通道内存足够，价格约为50-70美元。
     - GPU：对 Stockfish 这样的单线程应用来说，独立GPU并不必要。
     - 主板：选择兼容选定 CPU 的主板，价格约为150-200美元。
     - 存储：250GB SATA SSD 足以满足需求，价格约为40-60美元。
     - 冷却解决方案：使用空气冷却器即可，价格约为30-50美元。
     - 电源供应单元：选择550W 80+ Bronze认证的电源，价格约为50-70美元。
     - 机箱：选择价格适中的ATX机箱，价格约为50-80美元。

2. **Photoshop（图像处理软件）**：
   - **性能特征**：CPU 和内存密集型，对GPU加速有一定需求。
   - **建议硬件**：
     - CPU：选择多核性能较高的处理器，如 Intel Core i9-12900K 或 AMD Ryzen 9 5900X。价格约为600-800美元。
     - 内存：16GB DDR4 3600MHz 双通道内存，价格约为120-150美元。
     - GPU：选择带有至少8GB显存的显卡，如 NVIDIA RTX 3060 Ti 或 AMD Radeon RX 6700 XT。价格约为400-500美元。
     - 主板：选择兼容选定 CPU 和 GPU 的主板，价格约为200-250美元。
     - 存储：500GB NVMe SSD，价格约为70-100美元。
     - 冷却解决方案：对 CPU 使用液冷解决方案，价格约为100-150美元。
     - 电源供应单元：选择650W 80+ Gold认证的电源，价格约为80-100美元。
     - 机箱：选择具有良好散热设计和良好外观的中档机箱，价格约为100-150美元。

3. **TensorFlow（深度学习框架）**：
   - **性能特征**：GPU加速的深度学习任务，对大量显存和高性能计算能力有需求。
   - **建议硬件**：
     - CPU：选择具有良好多核性能的处理器，如 Intel Core i9-12900K 或 AMD Ryzen 9 5900X。价格约为600-800美元。
     - 内存：32GB DDR4 3600MHz 双通道内存，价格约为200-250美元。
     - GPU：选择至少具有12GB显存的显卡，如 NVIDIA RTX 3080 或 AMD Radeon RX 6900 XT。价格约为800-1000美元。
     - 主板：选择兼容选定 CPU 和 GPU 的主板，价格约为250-300美元。
     - 存储：1TB NVMe SSD，价格约为100-150美元。
     - 冷却解决方案：对 CPU 使用高性能液冷解决方案，价格约为150-200美元。
     - 电源供应单元：选择750W 80+ Platinum认证的电源，价格约为150-200美元。
     - 机箱：选择具有良好散热设计和足够空间的高端机箱，价格约为200-250美元。

4. **WordPress（网站搭建工具）**：
   - **性能特征**：CPU和存储密集型，对GPU无要求。
   - **建议硬件**：
     - CPU：选择具有良好多核性能的处理器，如 Intel Core i7-12700K 或 AMD Ryzen 7 5800X。价格约为400-500美元。
     - 内存：16GB DDR4 3200MHz 双通道内存，价格约为120-150美元。
     - GPU：无需独立显卡。
     - 主板：选择兼容选定 CPU 的主板，价格约为150-200美元。
     - 存储：500GB NVMe SSD，价格约为70-100美元。
     - 冷却解决方案：使用空气冷却器即可，价格约为30-50美元。
     - 电源供应单元：选择550W 80+ Bronze认证的电源，价格约为50-70美元。
     - 机箱：选择价格适中的ATX机箱，价格约为50-80美元。

对于硬件选择，我会优先考虑满足应用程序性能需求的部件，并在需要时选择性能更高的部件。我会在CPU和内存方面投入较多资金，因为它们对于大多数应用程序来说是关键的。另外，针对需要GPU加速的应用程序，我会选择具有良好性能和大量显存的显卡。在其他方面，我会尽量选择性价比高的部件，以节省预算。

为了指导我的决策，我可能会运行一些额外的性能实验，例如基准测试和负载测试，以评估不同硬件组合的性能表现。我还可能参考专业评测和用户评价，了解各个硬件组件的性能和可靠性。最终的决策将基于综合考虑性能、价格和可用预算。