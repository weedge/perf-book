---
typora-root-url: ..\..\img
---

# 优化计算

在上章节中，我们讨论了如何清除路径以实现高效的内存访问。完成后，是时候研究 CPU 如何使用从内存中获取的数据。现代应用程序需要大量的 CPU 计算，尤其是涉及复杂图形、人工智能、加密货币挖掘和大数据处理的应用程序。在本章中，我们将重点关注优化计算，可以减少 CPU 需要做的工作量并提高程序的整体性能。

当应用 TMA 方法时，低效计算通常反映在“核心绑定”类别中，并在一定程度上反映在“退休”类别中。“核心绑定”类别代表 CPU 乱序执行引擎内部的所有停顿，这些停顿不是由内存问题引起的。主要有两大类：

* 软件指令之间的数据依赖性限制了性能。例如，一系列长的依赖操作可能导致指令级并行性 (ILP) 低，并浪费许多执行槽位。下一节将更详细地讨论数据依赖链。
* 硬件计算资源不足（也称为执行吞吐量不足）。它表明某些执行单元过载（也称为执行端口争用）。当工作负载频繁执行许多相同类型的指令时，可能会发生这种情况。例如，AI 算法通常执行大量乘法，科学应用程序可能运行许多除法和开方运算。但是任何给定的 CPU 核心中的乘法器和除法器数量都有限。因此，当端口争用发生时，指令会排队等待执行。这种类型的性能瓶颈与特定的 CPU 微架构非常特定，通常无法治愈。

[TODO:] 提供有关如何检测端口争用的指南。

在 [@sec:TMA] 中，我们说高“退休”指标是一个性能良好的代码的良好指标。其背后的原理是执行没有停顿，CPU 以高速度执行指令。然而，有时它可能会掩盖真正的性能问题，即低效的计算。工作负载可能执行许多指令，这些指令过于简单，没有做太多有用的工作。在这种情况下，高“退休”指标不会转化为高性能。

在本章中，我们将研究一些众所周知的技术，例如函数内联、矢量化和循环优化。这些代码转换旨在减少执行的指令总数，或者用更有效的指令替换它们。

